$(document).ready(function() {


    $('.display').DataTable({
        responsive: true
    });

    $('.label').tooltipster({
        contentAsHTML: true,
        interactive: true,

    });



    $('#date_in').datepicker({ dateFormat: 'yy-mm-dd' });
    $('#date_out').datepicker({ dateFormat: 'yy-mm-dd' });
    $('#date_inv').datepicker({ dateFormat: 'yy-mm-dd' });

    $("#tabs").tabs({
        beforeLoad: function(event, ui) {
            ui.jqXHR.fail(function() {
                ui.panel.html(
                    "Couldn't load this tab. We'll try to fix this as soon as possible. " +
                    "If this wouldn't be a demo.");
            });
        }
    });



    if ($('.animsition').length) {
        $('.animsition').animsition({
            inClass: 'fade-in',
            outClass: 'fade-out',
            inDuration: 400,
            outDuration: 200,
            linkElement: 'a[href]:not([target="_blank"]):not([href^="mailto\\:"]):not([href^="\\#"])',
            loading: true,
            loadingParentElement: 'body',
            loadingClass: 'animsition-loading',
            unSupportCss: ['animation-duration', '-webkit-animation-duration', '-o-animation-duration'],
            overlay: false,
            overlayClass: 'animsition-overlay-slide',
            overlayParentElement: 'body'
        });
    }

    if ($('#password').length) {
        var options = {};

        options.ui = {
            container: '#pwd-container',
            showVerdictsInsideProgressBar: true,
            viewports: {
                progress: '.pwstrength_viewport_progress'
            }
        };
        options.common = {
            debug: false,
            onLoad: function() {
                $('#messages').text('Start typing password');
            }
        };

        $('#password').pwstrength(options);
    }

    if ($('#group_bgcolor').length) {
        var elem = $('#group_bgcolor');

        elem.ColorPickerSliders({
            size: 'lg',
            placement: 'auto bottom',
            previewformat: 'hex',
            color: elem.attr('data-src'),
            swatches: ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#009688', '#FF5722', '#795548', '#607D8B', '#000000'],
            customswatches: false,
            order: {}
        });

        $('button[type="reset"]').on('click', function(e) {
            elem.trigger('colorpickersliders.updateColor', elem.attr('data-src'));
        });
    }
    var part_name_option = {
        url: "getpartsname",
        getValue: "p_desc",

        template: {
            type: "description",
            fields: {
                description: "cat_name"
            }
        },
        list: {
            showAnimation: {
                type: "fade", //normal|slide|fade
                time: 400,
                callback: function() {}
            },

            hideAnimation: {
                type: "slide", //normal|slide|fade
                time: 400,
                callback: function() {}
            },
            maxNumberOfElements: 10,
            match: {
                enabled: true
            },
            onSelectItemEvent: function() {
                var value = $("#p_name").getSelectedItemData().p_id;

                $("#p_id").val(value).trigger("change");
            }
        }
    };

    $("#p_name").easyAutocomplete(part_name_option);

    var part_name_option2 = {
        url: "../getpartsname",
        getValue: "p_desc",

        template: {
            type: "description",
            fields: {
                description: "cat_name"
            }
        },
        list: {
            showAnimation: {
                type: "fade", //normal|slide|fade
                time: 400,
                callback: function() {}
            },

            hideAnimation: {
                type: "slide", //normal|slide|fade
                time: 400,
                callback: function() {}
            },
            maxNumberOfElements: 10,
            match: {
                enabled: true
            },
            onSelectItemEvent: function() {
                var value = $("#p_name2").getSelectedItemData().p_id;

                $("#p_id2").val(value).trigger("change");
            }
        }
    };

    $("#p_name2").easyAutocomplete(part_name_option2);


    var customer_name_option = {
        url: "getcustomersname",
        getValue: "c_name",

        template: {
            type: "description",
            fields: {
                description: "c_person"
            }
        },
        list: {
            showAnimation: {
                type: "fade", //normal|slide|fade
                time: 400,
                callback: function() {}
            },

            hideAnimation: {
                type: "slide", //normal|slide|fade
                time: 400,
                callback: function() {}
            },
            maxNumberOfElements: 10,
            match: {
                enabled: true
            },
            onSelectItemEvent: function() {
                var value = $("#customer").getSelectedItemData().c_id;

                $("#c_id").val(value).trigger("change");
            }
        }
    };

    $("#customer").easyAutocomplete(customer_name_option);

    var customer_name_option2 = {
        url: "../getcustomersname",
        getValue: "c_name",

        template: {
            type: "description",
            fields: {
                description: "c_person"
            }
        },
        list: {
            showAnimation: {
                type: "fade", //normal|slide|fade
                time: 400,
                callback: function() {}
            },

            hideAnimation: {
                type: "slide", //normal|slide|fade
                time: 400,
                callback: function() {}
            },
            maxNumberOfElements: 10,
            match: {
                enabled: true
            },
            onSelectItemEvent: function() {
                var value = $("#customer2").getSelectedItemData().c_id;

                $("#c_id").val(value).trigger("change");
            }
        }
    };

    $("#customer2").easyAutocomplete(customer_name_option2);

    var jobno_option = {
        url: "../getjobs/" + $('#jobno_h').val(),
        getValue: "job_no",

        template: {
            type: "description",
            fields: {
                description: "status"
            }
        },
        list: {
            showAnimation: {
                type: "fade", //normal|slide|fade
                time: 400,
                callback: function() {}
            },

            hideAnimation: {
                type: "slide", //normal|slide|fade
                time: 400,
                callback: function() {}
            },
            maxNumberOfElements: 10,
            match: {
                enabled: true
            },
        }
    };

    $("#jobno").easyAutocomplete(jobno_option);


    var jobno_option2 = {
        url: "./getjobs/" + $('#jobno_h').val(),
        getValue: "job_no",

        template: {
            type: "description",
            fields: {
                description: "status"
            }
        },
        list: {
            showAnimation: {
                type: "fade", //normal|slide|fade
                time: 400,
                callback: function() {}
            },

            hideAnimation: {
                type: "slide", //normal|slide|fade
                time: 400,
                callback: function() {}
            },
            maxNumberOfElements: 10,
            match: {
                enabled: true
            },
        }
    };

    $("#jobno2").easyAutocomplete(jobno_option2);


    var test_no_options = {
        url: "../get_testno/" + $('#jobno').val(),
        getValue: "test_no",

        template: {
            type: "description",
            fields: {
                description: "t_user"
            }
        },
        list: {
            showAnimation: {
                type: "fade", //normal|slide|fade
                time: 400,
                callback: function() {}
            },

            hideAnimation: {
                type: "slide", //normal|slide|fade
                time: 400,
                callback: function() {}
            },
            maxNumberOfElements: 10,
            match: {
                enabled: true
            },
        }
    };

    $("#test_no").easyAutocomplete(test_no_options);


    $("#jobno2").change(function() {
        var test_no_options2 = {
            url: "./get_testno/" + $('#jobno2').val(),
            getValue: "test_no",

            template: {
                type: "description",
                fields: {
                    description: "t_user"
                }
            },
            list: {
                showAnimation: {
                    type: "fade", //normal|slide|fade
                    time: 400,
                    callback: function() {}
                },

                hideAnimation: {
                    type: "slide", //normal|slide|fade
                    time: 400,
                    callback: function() {}
                },
                maxNumberOfElements: 10,
                match: {
                    enabled: true
                },
            }
        };

        $("#test_no2").easyAutocomplete(test_no_options2);
    })

    var imagesPreview = function(input, placeToInsertImagePreview) {

        if (input.files) {
            var filesAmount = input.files.length;

            for (i = 0; i < filesAmount; i++) {
                var reader = new FileReader();

                reader.onload = function(event) {
                    $($.parseHTML('<img width = "50%">')).attr('src', event.target.result).appendTo(placeToInsertImagePreview);
                }

                reader.readAsDataURL(input.files[i]);
            }
        }

    };

    $('#upload').on('change', function() {
        $('div.gallery').html('');
        imagesPreview(this, 'div.gallery');
    });

    $(document).on('click', '#btnRemoveItem', function() {

        var id = $(this).attr('data-id');
        var job_no = $(this).attr('data-jobno');

        swal({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!',
            showLoaderOnConfirm: true,
        }).then(function(result) {
            if (result.value) {
                return $.get("../item_remove/" + id + "/" + job_no)
                    .then(function(data) {
                        if (data == 'success') {
                            $("#tblItemList").find("button[data-id='" + id + "']").closest("tr").remove();
                            swal(
                                'Deleted!',
                                'Your item has been deleted.',
                                'success'
                            )
                        } else {
                            //$("#tblItemList").find("button[data-id='" + id + "']").closest("tr").remove();
                            swal(
                                'Warning!',
                                data,
                                'warning'
                            )
                        }

                    })

            } else if (result.dismiss === 'cancel') {
                swal(
                    'Cancelled',
                    'Your item is safe :)',
                    'error'
                )
            }
        })



    });




});




$(window).load(function() {


});